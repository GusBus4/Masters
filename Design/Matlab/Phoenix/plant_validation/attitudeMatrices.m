% % Attitude dynamics Kalman

Ix = 0.026;
Iy = 0.15;
Iz = 0.18;
g  = 9.81;
m  = 3.352;
% % Rate and NWdisturbance Matrix
%  A = [0 0 0 0 0 0
%  
%  B = [1/Ix 0    0    0    0    0;
%       0    1/Iy 0    0    0    0;
%       0    0    1/Iz 0    0    0;
%       0    0    0    1/Ix 0    0;
%       0    0    0    0    1/Iy 0;
%       0    0    0    0    0    1/Iz];
%   
%  C = [1  0  0  0 0 0;
%       0  1  0  0 0 0;
%       0  0  1  0 0 0;
%       -0 0  0  1 0 0;
%       0  -0 0  0 1 0;
%       0  0  -0 0 0 1];
%   
%   D=zeros(6,6);
  % Kalman for every state no disturbance
    % x = [phi theta psi p q r u v w x y z]'

  A = [0 0  0 1 0 0 0 0 0 0 0 0;
       0 0  0 0 1 0 0 0 0 0 0 0;
       0 0  0 0 0 1 0 0 0 0 0 0;
       0 0  0 0 0 0 0 0 0 0 0 0;
       0 0  0 0 0 0 0 0 0 0 0 0;
       0 0  0 0 0 0 0 0 0 0 0 0;
       0 -g 0 0 0 0 0 0 0 0 0 0;
       g 0  0 0 0 0 0 0 0 0 0 0;
       0 0  0 0 0 0 0 0 0 0 0 0;
       0 0  0 0 0 0 1 0 0 0 0 0;
       0 0  0 0 0 0 0 1 0 0 0 0;
       0 0  0 0 0 0 0 0 1 0 0 0];
   % u = [Fx Fy Fz Torquephi Torquetheta Torquepsi]'
  B = [0   0   0    0    0    0;
       0   0   0    0    0    0;
       0   0   0    0    0    0;
       0   0   0    1/Ix 0    0;
       0   0   0    0    1/Iy 0;
       0   0   0    0    0    1/Iz;      
       1/m 0   0    0    0    0;
       0   1/m 0    0    0    0;
       0   0   1/m  0    0    0;
       0   0   0    0    0    0;
       0   0   0    0    0    0;
       0   0   0    0    0    0];
  
 C = [1 0 0 0 0 0 0 0 0 0 0 0;
      0 1 0 0 0 0 0 0 0 0 0 0;
      0 0 1 0 0 0 0 0 0 0 0 0;
      0 0 0 1 0 0 0 0 0 0 0 0;
      0 0 0 0 1 0 0 0 0 0 0 0;
      0 0 0 0 0 1 0 0 0 0 0 0;
      0 0 0 0 0 0 1 0 0 0 0 0;
      0 0 0 0 0 0 0 1 0 0 0 0;
      0 0 0 0 0 0 0 0 1 0 0 0;
      0 0 0 0 0 0 0 0 0 1 0 0;
      0 0 0 0 0 0 0 0 0 0 1 0;
      0 0 0 0 0 0 0 0 0 0 0 1]; 
     
 QR1  = [1 0.1]; 
 QR2  = [0.1 10]; 
 QR3  = [1 1]; 
 QR4  = [10 0.1]; 
 QR5  = [100000 10000]; 
 QR6  = [100000 10000]; 
 QR7  = [1 1]; 
 QR8  = [1 1]; 
 QR9  = [1 1]; 
 QR10 = [1 1]; 
 QR11 = [1 1]; 
 QR12 = [1 1]; 
         
 D = zeros(12,6);
 Q = diag([QR1(1) QR2(1) QR3(1) QR4(1) QR5(1) QR6(1) QR7(1) QR8(1) QR9(1) QR10(1) QR11(1) QR12(1)]);
 R = diag([QR1(2) QR2(2) QR3(2) QR4(2) QR5(2) QR6(2) QR7(2) QR8(2) QR9(2) QR10(2) QR11(2) QR12(2)]);
 
%Processnoise = whitenoise([1 1 1]*0.00001)
%Measurementnoise = whitenoise([1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1]*0.0001)
%  ss(A,B,C,D);
%% with dobc  
  % Kalman for every state and disturbance
  % x = [phi theta psi p q r u v w x y z dphi dtheta dpsi]'
%   A = [0 0  0 1 0 0 0 0 0 0 0 0 0 0 0;
%        0 0  0 0 1 0 0 0 0 0 0 0 0 0 0;
%        0 0  0 0 0 1 0 0 0 0 0 0 0 0 0;
%        0 0  0 0 0 0 0 0 0 0 0 0 0 0 0;
%        0 0  0 0 0 0 0 0 0 0 0 0 0 0 0;
%        0 0  0 0 0 0 0 0 0 0 0 0 0 0 0;
%        0 -g 0 0 0 0 0 0 0 0 0 0 0 0 0;
%        g 0  0 0 0 0 0 0 0 0 0 0 0 0 0;
%        0 0  0 0 0 0 0 0 0 0 0 0 0 0 0;
%        0 0  0 0 0 0 1 0 0 0 0 0 0 0 0;
%        0 0  0 0 0 0 0 1 0 0 0 0 0 0 0;
%        0 0  0 0 0 0 0 0 1 0 0 0 0 0 0;
%        0 0  0 0 0 0 0 0 0 0 0 0 0 0 0;
%        0 0  0 0 0 0 0 0 0 0 0 0 0 0 0;
%        0 0  0 0 0 0 0 0 0 0 0 0 0 0 0];
%    % u = [Fx Fy Fz Torquephi Torquetheta Torquepsi]'
%   B = [0   0   0    0    0    0;
%        0   0   0    0    0    0;
%        0   0   0    0    0    0;
%        0   0   0    1/Ix 0    0;
%        0   0   0    0    1/Iy 0;
%        0   0   0    0    0    1/Iz;      
%        1/m 0   0    0    0    0;
%        0   1/m 0    0    0    0;
%        0   0   1/m  0    0    0;
%        0   0   0    0    0    0;
%        0   0   0    0    0    0;
%        0   0   0    0    0    0;
%        0   0   0    1/Ix 0    0;
%        0   0   0    0    1/Iy 0;
%        0   0   0    0    0    1/Iz];
%   
%  C = [1 0 0 0 0 0 0 0 0 0 0 0 0 0 0;
%       0 1 0 0 0 0 0 0 0 0 0 0 0 0 0;
%       0 0 1 0 0 0 0 0 0 0 0 0 0 0 0;
%       0 0 0 1 0 0 0 0 0 0 0 0 0 0 0;
%       0 0 0 0 1 0 0 0 0 0 0 0 0 0 0;
%       0 0 0 0 0 1 0 0 0 0 0 0 0 0 0;
%       0 0 0 0 0 0 0 0 0 1 0 0 0 0 0;
%       0 0 0 0 0 0 0 0 0 0 1 0 0 0 0;
%       0 0 0 0 0 0 0 0 0 0 0 1 0 0 0;
%       0 0 0 0 0 0 0 0 0 0 0 0 1 0 0;
%       0 0 0 0 0 0 0 0 0 0 0 0 0 1 0;
%       0 0 0 0 0 0 0 0 0 0 0 0 0 0 1]; 
%       
%  D = zeros(12,6);

%  ss(A,B,C,D)